
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Zeiterfassung</title>
</head>
<body>
  <header>
    <img id="brandLogo" src="./assets/logo.png" alt="Logo" style="height:60px">
    <h1>Zeiterfassung</h1>
  </header>
  <div id="loginView">
    <input id="loginUser" placeholder="Benutzer">
    <input id="loginPass" type="password" placeholder="Passwort">
    <button id="btnLogin">Login</button>
  </div>
  <div id="appView" class="hidden">
    <p>App-Inhalt hier...</p>
    <select id="photoProject"></select>
  </div>
<script>
const STORE={users:"users"};
let currentUser=null;
async function getAll(store){return [];} // Platzhalter
async function get(store,key){return null;}
async function put(store,obj){return obj;}

async function ensureFirstAdmin(){
  const users = await getAll(STORE.users);
  if(!users || users.length===0){
    await put(STORE.users,{username:'admin',password:'admin',role:'admin',display:'Administrator',active:true});
  }
}

async function login(u,p){
  const user = await get(STORE.users,u);
  if(!user){alert('Nutzer nicht gefunden');return;}
  if(user.active===false){alert('Nutzer ist deaktiviert');return;}
  if(user.password!==p){alert('Passwort falsch');return;}
  currentUser=user;
  localStorage.setItem('cu',JSON.stringify(user));
  document.getElementById('loginView').classList.add('hidden');
  document.getElementById('appView').classList.remove('hidden');
}

window.addEventListener('DOMContentLoaded', async ()=>{
  await ensureFirstAdmin();
  document.getElementById('btnLogin').onclick=async()=>{
    const u=document.getElementById('loginUser').value.trim();
    const p=document.getElementById('loginPass').value;
    try{await login(u,p);}catch(e){alert('Login fehlgeschlagen');}
  };
  const photoSel=document.getElementById('photoProject');
  if(photoSel){
    photoSel.onchange=()=>{if(typeof refreshPhotoGrid==='function')refreshPhotoGrid();};
  }
});
</script>
</body>
</html>
