<!doctype html>
<html lang="de"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mitarbeiterverwaltung – V60</title><link rel="icon" href="/Zeiterfassung/assets/logo.png"><style>
:root{--bg:#faf6f6;--ink:#1e1e1e;--brand:#2b261f;--line:#ddd;--card:#fff;--btn:#8c7b6a}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
header{background:#d9c9b9;color:var(--brand);padding:10px 14px;display:flex;gap:12px;align-items:center;justify-content:space-between}
header a{color:var(--brand);text-decoration:none}
.wrap{max-width:1100px;margin:0 auto;padding:12px}
.card{background:var(--card);border-radius:12px;padding:16px;margin:12px 0;box-shadow:0 6px 20px rgba(0,0,0,.06)}
label{display:block;font-size:12px;margin:6px 0 3px;color:#555}
input,select,textarea{width:100%;padding:10px;border:1px solid var(--line);border-radius:10px;font:inherit}
.row{display:grid;gap:12px}.row-2{grid-template-columns:1fr 1fr}.row-3{grid-template-columns:1fr 1fr 1fr}
@media(max-width:820px){.row-2,.row-3{grid-template-columns:1fr}}
button{background:var(--btn);color:#fff;border:0;border-radius:10px;padding:10px 16px;font:inherit;cursor:pointer}
button.ghost{background:#fff;color:var(--ink);border:1px solid var(--line)}
table{width:100%;border-collapse:collapse}
th,td{border-bottom:1px solid var(--line);text-align:left;padding:10px;font-size:14px}
.muted{color:#777}
.badge{background:#fff;border:1px solid var(--line);padding:4px 8px;border-radius:999px}
</style></head>
<body>
<header>
  <strong>Mitarbeiterverwaltung</strong>
  <nav style="display:flex;gap:12px;align-items:center">
    <a href="/Zeiterfassung/">← Zurück</a>
  </nav>
</header>
<main class="wrap">
  <section class="card">
    <h3>Neuen Benutzer anlegen</h3>
    <div class="row row-3">
      <div><label>Benutzername</label><input id="nuUser"></div>
      <div><label>Anzeigename</label><input id="nuName"></div>
      <div><label>Passwort</label><input id="nuPass" type="password" placeholder="leer = 1234"></div>
    </div>
    <div class="row row-2" style="margin-top:8px">
      <div><label>Rolle</label><select id="nuRole">
        <option value="mitarbeiter">Mitarbeiter</option>
        <option value="teamleiter">Teamleiter</option>
        <option value="admin">Admin</option></select></div>
      <div style="display:flex;align-items:end"><button id="btnAdd">Anlegen</button></div>
    </div>
  </section>
  <section class="card">
    <h3>Benutzerliste</h3>
    <table><thead><tr><th>Benutzer</th><th>Anzeigename</th><th>Rolle</th><th>Status</th><th>Aktion</th></tr></thead>
      <tbody id="tbl"></tbody></table>
  </section>
</main>
<script>
const CU_KEY='cu2'; const me=()=>{try{return JSON.parse(localStorage.getItem(CU_KEY)||'null');}catch{return null;}};
if(!me()) location.href='/Zeiterfassung/'; else if(me().role!=='admin'){ alert('Nur Administratoren.'); location.href='/Zeiterfassung/'; }

const DB_NAME='zeit-web-v60'; const STORE={users:'users'};
function openDB(){return new Promise((res,rej)=>{const r=indexedDB.open(DB_NAME,1); r.onsuccess=()=>res(r.result); r.onerror=()=>rej(r.error);});}
const os=(db,n,m='readonly')=>db.transaction(n,m).objectStore(n);

async function listUsers(){const db=await openDB(); const s=os(db,'users'); const rows=[]; await new Promise(r=>{const c=s.openCursor(); c.onsuccess=e=>{const cur=e.target.result; if(cur){rows.push(cur.value); cur.continue();} else r();};}); rows.sort((a,b)=>a.username.localeCompare(b.username)); const tb=document.getElementById('tbl'); tb.innerHTML=''; for(const u of rows){ const tr=document.createElement('tr'); tr.innerHTML=`<td>${u.username}</td><td>${u.display||''}</td>
<td><select data-act="role" data-id="${u.username}"><option value="mitarbeiter">Mitarbeiter</option><option value="teamleiter">Teamleiter</option><option value="admin">Admin</option></select></td>
<td><select data-act="stat" data-id="${u.username}"><option value="active">aktiv</option><option value="inactive">inaktiv</option></select></td>
<td style="display:flex;gap:8px"><button class="ghost" data-act="reset" data-id="${u.username}">Passwort 1234</button><button class="ghost" data-act="del" data-id="${u.username}">Löschen</button></td>`; tb.appendChild(tr);
tr.querySelector('[data-act=role]').value=u.role||'mitarbeiter'; tr.querySelector('[data-act=stat]').value=u.status||'active'; }}
}
async function addUser(){const username=document.getElementById('nuUser').value.trim(); const display=document.getElementById('nuName').value.trim(); const pass=document.getElementById('nuPass').value.trim()||'1234'; const role=document.getElementById('nuRole').value; if(!username) return alert('Benutzername fehlt'); const db=await openDB(); await new Promise(r=>{os(db,'users','readwrite').put({username,display,pass,role,status:'active'}).onsuccess=()=>r();}); document.getElementById('nuUser').value=''; document.getElementById('nuName').value=''; document.getElementById('nuPass').value=''; await listUsers();}
async function updateUser(id,patch){const db=await openDB(); const s=os(db,'users'); const u=await new Promise(r=>{const q=s.get(id); q.onsuccess=()=>r(q.result);}); if(!u) return; Object.assign(u,patch); await new Promise(r=>{os(db,'users','readwrite').put(u).onsuccess=()=>r();});}
async function delUser(id){ if(!confirm('Benutzer löschen?')) return; const db=await openDB(); await new Promise(r=>{os(db,'users','readwrite').delete(id).onsuccess=()=>r();}); await listUsers(); }

window.addEventListener('DOMContentLoaded',async()=>{ await listUsers(); document.getElementById('btnAdd').onclick=addUser; document.getElementById('tbl').addEventListener('change',async e=>{const t=e.target; const id=t.getAttribute('data-id'); if(t.getAttribute('data-act')==='role') await updateUser(id,{role:t.value}); if(t.getAttribute('data-act')==='stat') await updateUser(id,{status:t.value}); }); document.getElementById('tbl').addEventListener('click',async e=>{const b=e.target.closest('button'); if(!b) return; const id=b.getAttribute('data-id'); if(b.getAttribute('data-act')==='reset') await updateUser(id,{pass:'1234'}); if(b.getAttribute('data-act')==='del') await delUser(id); }); });
</script>
</body></html>
