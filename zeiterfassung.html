<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Arbeitseinteilung und Zeiterfassung Holzbau Zaunschirm – Zeiterfassung</title>
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16.png">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <link rel="stylesheet" href="assets/css/style.css">
  <meta name="theme-color" content="#2F3438">
</head>
<body>
<header class="topbar">
  <div class="brand"><span class="logo-dot"></span><span class="brand-text">Arbeitseinteilung und Zeiterfassung Holzbau Zaunschirm</span></div>
  <nav class="nav">
    <a href="dashboard.html">Übersicht</a>
    <a href="mitarbeiter.html" class="require-role-admin">Mitarbeiter</a>
    <a href="zeiterfassung.html">Zeiterfassung</a>
    <a href="plan.html">Wocheneinteilung</a>
    <a href="reports.html" class="require-role-admin">Berichte</a>
    <button id="logoutBtn" class="btn-ghost">Logout</button>
      <a href="backup.html" class="require-role-admin">Backup</a>
        <a href="cloud.html" class="require-role-admin">Cloud</a>
    </nav>
</header>
<main class="container">

<section class="card">
  <h2>Zeiterfassung</h2>
  <div class="row wrap">
    <label>Mitarbeiter<br><div id="userChecklist" class="card" style="max-height:220px; overflow:auto; padding:8px"></div><small id="multiHint" style="color:#6b7280">Mehrere ankreuzen</small></label>
    <label>Datum <input type="date" id="dateInput"></label>
    <label>Tagesstatus
      <select id="dayStatus"><option value="work">Arbeit</option><option value="vacation">Urlaub</option><option value="sick">Krank</option></select>
    </label>
  </div>
  <div class="row wrap">
    <label>Pause (Dropdown)
      <select id="pauseDropdown"><option value="0">keine</option><option value="15">15 min</option><option value="30" selected>30 min</option><option value="45">45 min</option><option value="60">60 min</option></select>
    </label>
  </div>
  <div class="row wrap" style="margin:6px 0 12px 0">
    <label>Projekt wählen
      <select id="projectSelect" style="min-width:220px"></select>
    </label>
    <div class="row" style="gap:6px">
      <label>Neues Projekt <input id="newProjName" placeholder="Projektname"></label>
      <label>Farbe <input id="newProjColor" type="color" value="#C8A86B"></label>
      <label>Kostenstelle <input id="newProjKst" placeholder="z.B. 4711-01"></label>
      <button id="addProjBtn" class="btn">Anlegen</button>
    </div>
  </div>
</section>

<section class="card">
  <h3>Arbeitszeit</h3>
  <div class="row wrap">
    <label>Start
      <input type="range" id="rangeStart" min="0" max="59" step="1">
      <div><small id="labelStart">—</small></div>
    </label>
    <label>Ende
      <input type="range" id="rangeEnd" min="0" max="59" step="1">
      <div><small id="labelEnd">—</small></div>
    </label>
  </div>
  <div class="timeline-legend">
    <div>Von: <span id="fromOut" class="timeout">—</span> · Bis: <span id="toOut" class="timeout">—</span></div>
    <div>Dauer: <span id="durOut" class="timeout">00:00</span> (abzgl. Pause)</div>
  </div>
  <div class="row"><button id="bookBtn" class="btn-primary">Buchen</button></div>
</section>

<h3>Monatsübersicht</h3>
<section class="card">
  <div class="row wrap">
    <div>Monat: <strong id="monthLabel">–</strong></div>
    <div style="margin-left:auto">Gesamt: <strong id="monthTotal">00:00</strong> • Überstunden (&gt;9:00/Tag): <strong id="monthOT">00:00</strong></div>
  </div>
  <table class="table" id="monthTable">
    <thead>
      <tr><th style="width:20%">Datum</th><th style="width:45%">Status / Projekte</th><th style="width:35%">Stunden (HH:MM)</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

</main>
<footer class="footer"><small>© 2025 Holzbau Zaunschirm • V02b</small></footer>
<script defer src="js/storage.js?v=02c"></script>
<script defer src="js/auth.js?v=02c"></script>
<script defer src="js/app.js?v=02c"></script>

<script defer src="js/times.js"></script>
<script>
document.addEventListener('DOMContentLoaded', ()=>{
  try{ protectPage(); renderNavByRole(); if(typeof initTimesPage==='function') initTimesPage(); }catch(e){ console.error(e); }
  // Hide project creation for non-admin
  try{
    const me=JSON.parse(localStorage.getItem('z_session')||'null');
    const users=JSON.parse(localStorage.getItem('z_users')||'[]');
    const u=users.find(x=>x.id===me?.userId);
    if(!u || u.role!=='admin'){
      const btn=document.getElementById('addProjBtn'); if(btn) btn.style.display='none';
      const np=document.getElementById('newProjName'); const nc=document.getElementById('newProjColor'); const nk=document.getElementById('newProjKst');
      if(np) np.disabled=true; if(nc) nc.disabled=true; if(nk) nk.disabled=true;
    }
  }catch(e){}
});
</script>

<script defer src="js/cloud.js"></script>
</body>
</html>