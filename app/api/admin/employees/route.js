
export const runtime='nodejs'; import { adminClient } from '../../../../lib/supabase'; import { createSalt, hashPin } from '../../../../lib/pin';
export async function GET(){ const s=adminClient(); const {data,error}=await s.from('employees').select('id,code,display_name,role,disabled').order('code'); if(error) return Response.json({error:error.message},{status:500}); return Response.json(data||[]); }
export async function POST(req){ try{ const b=await req.json(); const {code,display_name,role='user',pin}=b||{}; if(!code||!display_name) return Response.json({error:'code & display_name erforderlich'},{status:400}); const salt=createSalt(); const hash=hashPin(pin||'0000',salt); const s=adminClient(); const {data,error}=await s.from('employees').insert({code,display_name,role,pin_salt:salt,pin_hash:hash,disabled:false}).select('id').single(); if(error) return Response.json({error:error.message},{status:500}); return Response.json({ok:true,id:data.id}); }catch(err){ console.error(err); return Response.json({error:'Serverfehler'},{status:500}); } }
